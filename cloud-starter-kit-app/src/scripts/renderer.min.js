
/*
* Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
* 
* THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/


let parser=new DOMParser;function appendHtmlToNode(e,t,n=!0){t=parser.parseFromString(t,"text/html");if(n)for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t.documentElement)}function bytesToBase64(e){e=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(e)}function findNameFromTags(t){for(let e=0;e<t.length;e++)if("Name"===t[e].Key)return t[e].Value;return""}function findSubnetTypeFromTags(t){for(let e=0;e<t.length;e++)if("aws-cdk:subnet-type"===t[e].Key)return t[e].Value.toLowerCase();return""}function guessSubnetType(e){return e.toLowerCase().includes("isolated")?"isolated":e.toLowerCase().includes("private")?"private":e.toLowerCase().includes("public")?"public":""}let getMyIp=async()=>{var e=await(await fetch("https://api.ipify.org/?format=json")).json();return e.hasOwnProperty("ip")&&e.ip.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)?e.ip:""};function openConsole(e){window.openInBrowser(e)}function setValueInNamespace(e,t,n){localStorage.setItem(e+"-"+t,n)}function getValueInNamespace(e,t){return localStorage.getItem(e+"-"+t)||""}function convertRegionCodeToName(e){var t={"us-east-1":"US: N. Virginia","us-east-2":"US: Ohio","us-west-1":"US: N. California","us-west-2":"US: Oregon","ap-southeast-4":"AU: Melbourne","ap-south-1":"IN: Mumbai","ap-northeast-3":"JP: Osaka","ap-northeast-2":"KR: Seoul","ap-southeast-1":"SG: Singapore","ap-southeast-2":"AU: Sydney","ap-northeast-1":"JP: Tokyo","ca-central-1":"CA: Central Canada","eu-central-1":"DE: Frankfurt","eu-west-1":"IE: Ireland","eu-west-2":"GB: London","eu-west-3":"FR: Paris","eu-north-1":"SE: Stockholm","sa-east-1":"BR: S√£o Paulo","af-south-1":"SA: Cape Town","ap-east-1":"CN: Hong Kong","ap-south-2":"IN: Hyderabad","ap-southeast-3":"ID: Jakarta","ca-west-1":"CA: Calgary","eu-central-2":"CH: Zurich","eu-south-1":"IT: Milan","eu-south-2":"ES: Spain","il-central-1":"IL: Tel Aviv","me-central-1":"AE: UAE","me-south-1":"BH: Bahrain","mx-central-1":"MX: Mexico","ap-southeast-7":"TH: Thailand","ap-southeast-6":"NZ: Auckland"};return t.hasOwnProperty(e)?t[e]:e}let taskQueue=[],TASK_TYPES={KIT_DEPLOYMENT:"kit-deployment",REGIONAL_PIPELINE_BUILD:"regional-pipeline-build",REGIONAL_DATA_LOADING:"regional-data-load",CREATE_KEY:"create-key-pair",OTHER:"other"},TASK_STATES={WAITING:"waiting",STARTED:"started",IN_PROGRESS:"in-progress",COMPLETE:"complete",FAILED:"failed",FAILED_NEEDS_DELETION:"failed-needs-deletion",DELETED:"deleted",DELETE_FAILED:"delete-failed"},TASK_EVENTS={LOADING_COMPLETE:"LOADING_COMPLETE",KEY_READY:"KEY_READY",DEPLOYMENT_COMPLETE:"DEPLOYMENT_COMPLETE",DEPLOYMENT_FAILED:"DEPLOYMENT_FAILED"};class Task{constructor(e,t){this.type=e,this.name=t,this.state=TASK_STATES.WAITING,this.lastCheck=null}}function evaluateStatus(e){return e.match(/(ATE_COMPLETE|UPDATE_ROLLBACK_COMPLETE|Succeeded)$/)?TASK_STATES.COMPLETE:e.match(/^(CREATE_FAILED|ROLLBACK_COMPLETE|ROLLBACK_FAILED|UPDATE_ROLLBACK_FAILED|Failed)/)?TASK_STATES.FAILED_NEEDS_DELETION:e.match(/DELETE_FAILED/)?TASK_STATES.FAILED:e.match(/DELETE_COMPLETE/)?TASK_STATES.DELETED:e.match(/(_IN_PROGRESS|InProgress)/)?TASK_STATES.IN_PROGRESS:TASK_STATES.FAILED}function addToTaskQueue(n){if(n instanceof Task){let t=!1;for(let e=0;e<taskQueue.length;e++)if(taskQueue[e].type===n.type&&taskQueue[e].name===n.name){t=!0;break}t||taskQueue.push(n)}}function checkTasks(t){if(0<taskQueue.length){for(let e=0;e<taskQueue.length;e++)switch(taskQueue[e].type){case TASK_TYPES.KIT_DEPLOYMENT:t.type===TASK_EVENTS.DEPLOYMENT_COMPLETE&&checkStackComplete(t.detail,taskQueue,e);break;case TASK_TYPES.REGIONAL_PIPELINE_BUILD:t.type===TASK_EVENTS.DEPLOYMENT_COMPLETE?checkStackComplete("csk-cdk-app-delivery-pipeline-stack",taskQueue,e):t.type===TASK_EVENTS.DEPLOYMENT_FAILED&&(taskQueue[e].state=TASK_STATES.FAILED);break;case TASK_TYPES.REGIONAL_DATA_LOADING:t.type===TASK_EVENTS.LOADING_COMPLETE?taskQueue[e].state=TASK_STATES.COMPLETE:(taskQueue[e].state=TASK_STATES.IN_PROGRESS,taskQueue[e].lastCheck=new Date);break;case TASK_TYPES.CREATE_KEY:t.type===TASK_EVENTS.KEY_READY?taskQueue[e].state=TASK_STATES.COMPLETE:(taskQueue[e].state=TASK_STATES.IN_PROGRESS,taskQueue[e].lastCheck=new Date)}removeCompletedTasks()}}function checkTasksFromStackList(){for(let e=0;e<taskQueue.length;e++)taskQueue[e].type===TASK_TYPES.KIT_DEPLOYMENT?checkStackComplete(taskQueue[e].name,taskQueue,e+0):taskQueue[e].type===TASK_TYPES.REGIONAL_PIPELINE_BUILD&&checkStackComplete("csk-cdk-app-delivery-pipeline-stack",taskQueue,e+0)}function checkStackComplete(e,n,t){let a=t;window.getStackStatus(e,function(e,t){a,e?e.message.match("does not exist")?(n[a].state=TASK_STATES.WAITING,n[a].lastCheck=new Date):n[a].state=TASK_STATES.FAILED:(n[a].state=evaluateStatus(t.Stacks[0].StackStatus),n[a].lastCheck=new Date,n[a].state===TASK_STATES.COMPLETE&&0<t.Stacks[0].Outputs.length&&"CskSourceBucketName"===t.Stacks[0].Outputs[0].ExportName&&setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[0].OutputValue))})}function removeCompletedTasks(){var t=[];for(let e=0;e<taskQueue.length;e++)taskQueue[e].state===TASK_STATES.COMPLETE||taskQueue[e].state===TASK_STATES.DELETED||taskQueue[e].state===TASK_STATES.FAILED?TASK_TYPES.KIT_DEPLOYMENT===taskQueue[e].type&&reenableKitButton(taskQueue[e].name):taskQueue[e].state===TASK_STATES.FAILED_NEEDS_DELETION?TASK_TYPES.KIT_DEPLOYMENT===taskQueue[e].type&&(reenableKitButton(taskQueue[e].name),showDeleteKitButton(taskQueue[e].name)):t.push(taskQueue[e]);taskQueue=t}function regionControlsCanBeUnlocked(){if(0!==taskQueue.length)for(let e=0;e<taskQueue.length;e++){if(taskQueue[e].type===TASK_TYPES.REGIONAL_DATA_LOADING&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1;if(taskQueue[e].type===TASK_TYPES.REGIONAL_PIPELINE_BUILD&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1;if(taskQueue[e].type===TASK_TYPES.KIT_DEPLOYMENT&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1}return!0}function showTaskQueueLength(){0<taskQueue.length?lockRegionControls(!0):lockRegionControls(!1),document.getElementById("tasks-display").innerText=`${0<taskQueue.length?taskQueue.length:"No"} task${1<taskQueue.length?"s":""} running`}Object.defineProperty(Task,"TYPES",{value:TASK_TYPES,writable:!1}),Object.defineProperty(Task,"STATES",{value:TASK_STATES,writable:!1}),Object.defineProperty(Task,"EVENTS",{value:TASK_EVENTS,writable:!1}),addEventListener("LOADING_COMPLETE",checkTasks),addEventListener("KEY_READY",checkTasks),addEventListener("DEPLOYMENT_COMPLETE",checkTasks),addEventListener("DEPLOYMENT_FAILED",checkTasks),setInterval(checkTasksFromStackList,5e3),setInterval(removeCompletedTasks,5e3),setInterval(showTaskQueueLength,1e3);let bouncyBox='<span class="la-square-jelly-box la-dark la-sm" style="margin-left: 3px; margin-right: 10px; margin-bottom: -1px; display: inline-block; color: black; height: 12px; width: 12px;"><div></div><div></div></span>',preMonitoringDelay=1,monitoringTimeout=1800,cfMonitor=null,longCfMonitor=null,stackStates={},lastReportedStates={},stackEvents={},stackInfoRequestors={},stackOutputs={},debugMessages={},mostRecentEventTime=null,allStacks={};function listAllStacks(){window.listStacks((e,t)=>{if(!e){allStacks={};for(let e=0;e<t.Stacks.length;e++)allStacks[t.Stacks[e].StackId]=t.Stacks[e];var n,e=document.getElementById("deployed-stacks"),a=(e.innerText="",document.createElement("div")),s=(a.classList.add("scrollable"),document.createElement("h1")),o=(s.classList=["installed-kits-heading"],s.innerText="Installed Kits",document.createElement("p"));for(n in o.innerText="This is a listing of the kits that have been deployed as CloudFormation stacks into this account.",a.appendChild(s),a.appendChild(o),allStacks)if(!(allStacks[n].StackName.match(/sendStatisticsStack/)||allStacks[n].hasOwnProperty("RootId")&&allStacks[n].RootId.match(/\w/))){var i=allStacks[n].Tags,l={};for(let e=0;e<i.length;e++)l[i[e].Key]=i[e].Value;if(l.hasOwnProperty("KitId")||"CDKToolkit"===allStacks[n].StackName){let e=allStacks[n].StackName;var r=getFromKitMetadata(l.KitId),r=(r&&(e=r.Name),document.createElement("h5")),d=(r.classList.add("sub-heading"),r.innerText=e,document.createElement("p")),c=(appendHtmlToNode(d,"<b>Status:</b> "+labelStatus(allStacks[n].StackStatus)),document.createElement("p")),u=(c.innerText=allStacks[n].Description||"No description available",document.createElement("p")),m=document.createElement("a"),p=(m.innerText="‚¨ÜÔ∏è Inputs",m.classList=["stack-info"],m.setAttribute("onclick",`showInputs("${allStacks[n].StackId}")`),document.createElement("a")),g=(p.innerText="‚¨áÔ∏è Outputs",p.classList=["stack-info"],p.setAttribute("onclick",`showOutputs("${allStacks[n].StackId}")`),document.createElement("a")),E=(g.innerText="üëÄ View in Console",g.classList=["stack-info"],g.setAttribute("onclick",`goToConsole("${allStacks[n].StackId}")`),document.createElement("div"));E.id=allStacks[n].StackId+"-metadata",E.classList.add("deployed-kit-metadata"),u.appendChild(m),u.appendChild(p),evaluateStatus(allStacks[n].StackStatus)===TASK_STATES.FAILED_NEEDS_DELETION&&((m=document.createElement("a")).innerText="üóëÔ∏è Delete",m.classList=["stack-info"],m.setAttribute("onclick",`confirmDeleteStack("${allStacks[n].StackId}")`),u.appendChild(m)),u.appendChild(g),a.appendChild(r),a.appendChild(d),a.appendChild(c),a.appendChild(u),a.appendChild(E)}}e.appendChild(a)}})}function confirmDeleteStack(e){confirm(`Are you sure you want to delete stack ${e}?`)&&window.deleteStack(e,(e,t)=>{})}function getFromKitMetadata(e){return kitMetadata.hasOwnProperty(e)?kitMetadata[e]:null}function showInputs(e){var t=allStacks[e],n=t.Parameters,a=[];for(let e=0;e<n.length;e++)"BootstrapVersion"!==n[e].ParameterKey&&a.push(n[e]);var t=localStorage.getItem(`${account}-${region}-`+t.StackName),s=t&&t.match(/^\[/)?JSON.parse(t):[],o=document.createElement("div");if(0===a.length&&0===s.length){t=document.createElement("div");t.innerText="Stack had no inputs.",o.appendChild(t)}else{for(let e=0;e<a.length;e++){var i=document.createElement("div");appendHtmlToNode(i,`<b>${a[e].ParameterKey}</b>: `+a[e].ParameterValue),o.appendChild(i)}for(let e=0;e<s.length;e++){var l=document.createElement("div");appendHtmlToNode(l,`<b>${s[e].ParameterKey}</b>: `+s[e].ParameterValue),o.appendChild(l)}}t=document.getElementById(e+"-metadata");t.innerText="",t.appendChild(o)}function showOutputs(e){var t=allStacks[e].Outputs,n=document.createElement("div");if(0===t.length){var a=document.createElement("div");a.innerText="Stack had no outputs.",n.appendChild(a)}else for(let e=0;e<t.length;e++){var s=document.createElement("div");appendHtmlToNode(s,`<b>${t[e].OutputKey}</b>: `+t[e].OutputValue),n.appendChild(s)}a=document.getElementById(e+"-metadata");a.innerText="",a.appendChild(n)}function goToConsole(e){openConsole(`https://${region}.console.aws.amazon.com/cloudformation/home?region=${region}#/stacks/stackinfo?stackId=`+e)}function resetStackMonitoring(){clearInterval(cfMonitor),clearInterval(longCfMonitor),stackStates={},lastReportedStates={},stackEvents={},stackInfoRequestors={},stackOutputs={},debugMessages={},mostRecentEventTime=null}function showStacksProgressFunc(){if(window.loggedIn){var e=window.getStacksInProgress();if(0<Object.keys(e).length)for(var t in e)e[t].tracking&&window.getStackEvents(t,stackEventsResponseHandler)}}let stackEventsResponseHandler=function(n,e,a){let s=window.getStacksInProgress();if(e&&e.hasOwnProperty("Timestamp")){let t=new Date(e.Timestamp).getTime();mostRecentEventTime=mostRecentEventTime||t,t>mostRecentEventTime&&(mostRecentEventTime=t);for(let e=0;e<a.length;e++)(t=new Date(a[e].Timestamp).getTime())>mostRecentEventTime&&(mostRecentEventTime=t);stackStates.hasOwnProperty(n)||(stackStates[n]={}),(stackStates[n]=e)&&e.hasOwnProperty("ResourceStatus")&&(s[n].status=e.ResourceStatus,evaluateStatus(e.ResourceStatus)===TASK_STATES.COMPLETE)&&s[n].hasOutputs&&!stackInfoRequestors.hasOwnProperty(n)&&(stackInfoRequestors[n]=setInterval(requestStackInfo,3e3,n)),0<Object.keys(a).length?stackEvents[n]=a:stackEvents[n]={},updateStackEventDisplay(s)}else window.getStackInfo(n,(e,t)=>{t&&t.toString().match("does not exist")||s[n].hasOwnProperty("updateRequested")&&s[n].updateRequested||t&&t.hasOwnProperty("Stacks")&&evaluateStatus(t.Stacks[0].StackStatus)===TASK_STATES.COMPLETE&&(window.handleCompletedStack(e),unlockInstallButton(s[n].kitId),registerProgress(s[n].kitId,100,`Kit has already been installed as <b>${n}</b>.`),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:t.Stacks[0].StackName})),stopMonitoring())})},eventOutput={},previousEventOutput={},updateStackEventDisplay=function(a){let s=Object.keys(a).length;for(var e in stackStates){var t=a[e].kitId;eventOutput.hasOwnProperty(t)||(eventOutput[t]={}),eventOutput[t][e]="",previousEventOutput[t]=document.getElementById(t+"-cf-stack-states").innerHTML}for(var o in stackStates){var i=a[o].kitId,l=document.getElementById("region-select").value,r=` <a onclick="openConsole('https://${l}.console.aws.amazon.com/cloudformation/home?region=${l}#/stacks/stackinfo?stackId=${stackStates[o].StackId}')">View in Console</a><br>`;0===Object.keys(stackStates).length&&(eventOutput[i][o]+=bouncyBox);let e=50,t=Number(a[o].resourceCount);var d=Object.keys(stackEvents[o]).length;0<(t=d>t?d:t)&&-1<d&&(e=d/t*100),eventOutput[i][o]+="<b>"+o+"</b>: ",lastReportedStates[o]!==stackStates[o].ResourceStatus?(phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:i,stack_status:stackStates[o].ResourceStatus,stack_name:o,details:stackStates[o]}),eventOutput[i][o]+=labelStatus(stackStates[o].ResourceStatus),eventOutput[i][o]+=r,evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.COMPLETE?(registerProgress(i,100,"Deployment complete"),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:o})),dispatchEvent(new Event("POST_STACK_UPDATE")),window.handleCompletedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED?(registerProgress(i,1,"Stack is in failed state and may need to be deleted via the console"),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED_NEEDS_DELETION?(registerProgress(i,100,"Stack is in failed state and should be deleted via the console"),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.DELETED?(registerProgress(i,1,"Stack has been deleted"),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):(registerProgress(i,e),window.keepWatchingStack(o)),lastReportedStates[o]=stackStates[o].ResourceStatus):(evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.COMPLETE||evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.DELETED?(s=--s,registerProgress(i,100)):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED||evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED_NEEDS_DELETION?(s=--s,registerProgress(i,1)):registerProgress(i,e),eventOutput[i][o]+=labelStatus(stackStates[o].ResourceStatus),eventOutput[i][o]+=r);let n="";var c=`<a onclick="openConsole('https://${l}.console.aws.amazon.com/cloudformation/home?region=${l}#/stacks/resources?stackId=${stackStates[o].StackId}')">`;if(0<Object.keys(stackEvents[o]).length)for(var u in stackEvents[o]){var m=u.replace(o.replace(/-stack/,"").replace(/-/g,""),"");n+=`‚îú‚îÄ <b>${stackEvents[o][u].ResourceType}</b> ${c}<div class="inline-truncated">${m}</div></a> ${labelStatus(stackEvents[o][u].ResourceStatus)}<br>`,stackEvents[o][u].ResourceType}else n+="‚îú‚îÄ No resources found";eventOutput[i][o]+=n}var n,p,g={};for(n in stackStates){var E=a[n].kitId;g.hasOwnProperty(E)||(g[E]=""),g[E]+=eventOutput[E][n]}for(p in g)previousEventOutput[p]!==g[p]&&appendHtmlToNode(document.getElementById(p+"-cf-stack-states"),g[p]);s<=0&&(s=0)};function unlockInstallButton(e){document.getElementById(e+"-install-button").disabled=!1}let requestStackInfo=function(e){window.getStackInfo(e,outputsResponseHandler)},outputsResponseHandler=function(e,t){t.hasOwnProperty("Stacks")&&0<t.Stacks[0].Outputs.length&&(clearInterval(stackInfoRequestors[t.Stacks[0].StackName]),stackOutputs[t.Stacks[0].StackName]=t.Stacks[0].Outputs,showCfnOutputs(t.Stacks[0].StackName))},htmlCfnOutputs={},showCfnOutputs=function(e){var t,n=window.getStacksInProgress()[e].kitId,e=document.getElementById(n+"-cf-stack-outputs");for(t in stackOutputs){htmlCfnOutputs.hasOwnProperty(n)||(htmlCfnOutputs[n]=""),htmlCfnOutputs[n]+="<b>"+t+":</b><br/>";for(let e=0;e<stackOutputs[t].length;e++)htmlCfnOutputs[n]+="<b>"+stackOutputs[t][e].OutputKey+"</b>: "+stackOutputs[t][e].OutputValue+"<br>"}appendHtmlToNode(e,htmlCfnOutputs[n])},deployResponseHandler=function(e,t,n){var a,s=window.getStacksInProgress();e&&(e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)&&(n=e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)[1]),stopMonitoring(),registerProgress(s[n].kitId,1,e.toString()),unlockInstallButton(s[n].kitId));let o=setInterval(()=>{regionControlsCanBeUnlocked()&&(lockRegionControls(!1),clearInterval(o))},3e3);n=n||(t&&t.hasOwnProperty("StackId")?t.StackId.split("/")[1]:e&&e.hasOwnProperty("StackId")?e.StackId.split("/")[1]:e&&e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)?e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)[1]:"Unknown"),e&&"Unknown"!==n?((e="object"==typeof e?e.toString():e).match(/credentials/i)?(displayCredentialErrors(!0,e),resetUi()):(debugMessages[n]=e,phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:s[n].kitId,stack_status:"failed",stack_name:n,details:e})),registerProgress(s[n].kitId,1,e),window.handleFailedStack(n)):e&&"Unknown"===n||t&&(debugMessages[n]=t,addToTaskQueue(new Task(Task.TYPES.KIT_DEPLOYMENT,n)),lockRegionControls(!0),registerProgress(s[n].kitId,1,"Kit uploaded successfully, starting deployment...please wait"),t.hasOwnProperty("Location")?(registerProgress(s[n].kitId,1,"Kit uploaded successfully, starting deployment pipeline..."),debugMessages[n]=`Deploying via pipeline: <a onclick="openConsole('https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines')">View in Console</a>`):t.hasOwnProperty("pipelineExecutionId")?(registerProgress(s[n].kitId,1,"Kit uploaded successfully, starting pipeline...please wait"),e=getValueInNamespace(account+"-"+region,"PipelineName"),a=`https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines/${e}/executions/${t.pipelineExecutionId}/visualization?region=`+region,debugMessages[n]=`Deploying via pipeline: <a onclick="openConsole('${a}')">View in Console</a>`,monitorPipeline(s[n].kitId,n,t.pipelineExecutionId,e)):t.hasOwnProperty("noOp")&&!0===t.noOp&&(phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:s[n].kitId,stack_status:"success",stack_name:n,details:t}),registerProgress(s[n].kitId,100,n+" already deployed"),window.handleCompletedStack(n)));var i,l,r={};for(i in debugMessages){var d=s[i].kitId;r.hasOwnProperty(d)||(r[d]={})}for(l in debugMessages){var c=s[l].kitId;r[c][l]="","object"==typeof debugMessages[l]?r[c][l]+=`<b>${l}</b>: `+JSON.stringify(debugMessages[l],null,4)+"<br>":r[c][l]+=t?`<b>${l}</b>:  <span class="success">`+debugMessages[l]+"</span><br>":`<b>${l}</b>:  <span class="error">`+debugMessages[l]+"</span><br>"}var u,m={};for(u in r){for(var p in m[u]="",r[u])m[u]+=r[u][p];appendHtmlToNode(document.getElementById(u+"-deploystack-output"),m[u])}};function monitorPipeline(a,s,o,i){let l=setInterval(()=>{window.getPipelineStatus(o,(e,t)=>{var n;t.hasOwnProperty("pipelineExecution")&&t.pipelineExecution.hasOwnProperty("status")?(n=`https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines/${i}/executions/${o}/visualization?region=`+region,n=`<span class="success"><b>Pipeline Status:</b> ${labelStatus(t.pipelineExecution.status).replace(/([a-z0-9])([A-Z])/g,"$1 $2")}&nbsp;&nbsp;&nbsp;<a onclick="openConsole('${n}')">View in Console</a></span><br>`,appendHtmlToNode(document.getElementById(a+"-deploystack-output"),n),"Succeeded"===t.pipelineExecution.status?(clearInterval(l),unlockInstallButton(a),registerProgress(a,100,s+" deployed successfully"),window.handleCompletedStack(s)):"Failed"===t.pipelineExecution.status||e?(clearInterval(l),unlockInstallButton(a),registerProgress(a,1,`Failed to deploy ${s} - check the console for more information`),window.handleFailedStack(s)):updateProgressBarMessage(a,s+" deployment: "+t.pipelineExecution.status.replace(/([a-z0-9])([A-Z])/g,"$1 $2"))):e&&(clearInterval(l),unlockInstallButton(a),registerProgress(a,1,"Pipeline failed - check the console for more information"),window.handleFailedStack(s))})},5e3)}function resetAllKitMonitors(){for(var e in kitMetadata)try{registerProgress(e,1),appendHtmlToNode(document.getElementById(e+"-deploystack-output"),""),appendHtmlToNode(document.getElementById(e+"-cf-stack-states"),""),appendHtmlToNode(document.getElementById(e+"-cf-stack-outputs"),""),document.getElementById(e+"-install-button").disabled=!1,document.getElementById(e+"-deployment-progress").style.display="none",document.getElementById(e+"-deployment-details").style.display="none",hideConfigForKit(e)}catch(e){}}function registerProgress(e,t,n=""){progressBars[e][1].style.width=Math.floor(t)+"%",progressBars[e][0].textContent=Math.floor(t)+"%",1===t||100===t?(n&&updateProgressBarMessage(e,n),progressBars[e][1].style["animation-play-state"]="paused",progressBars[e][0].textContent=""):progressBars[e][1].style["animation-play-state"]="running"}function updateProgressBarMessage(e,t){t&&(progressBars[e][2].textContent=t)}function startMonitoring(){setTimeout(()=>{cfMonitor=setInterval(showStacksProgressFunc,3e3)},1e3*preMonitoringDelay),longCfMonitor=setTimeout(monitoringChecker,1e3*monitoringTimeout)}function stopMonitoring(){clearInterval(cfMonitor),clearInterval(longCfMonitor)}function monitoringChecker(){(new Date).getTime()-mostRecentEventTime>1e3*monitoringTimeout?(displayErrors(`Monitoring timeout reached - ${monitoringTimeout}s has passed with no new events. Check the status of your stacks in the CloudFormation console.`),stopMonitoring()):setTimeout(monitoringChecker,3e3)}function clearStackMonitor(e){window.clearTrackedStacks(e)}function clearStackMonitors(){window.clearTrackedStacks()}function labelStatus(e){let t="";return t=evaluateStatus(e)===TASK_STATES.COMPLETE?e+"  ‚úÖ":evaluateStatus(e)===TASK_STATES.FAILED||evaluateStatus(e)===TASK_STATES.FAILED_NEEDS_DELETION||evaluateStatus(e)===TASK_STATES.DELETED||evaluateStatus(e)===TASK_STATES.DELETE_FAILED?e+"  ‚ùå":e+"  "+bouncyBox}let excludedAttributes=["id","name","value","type","value","style","class","min","max","required","pattern","onchange"];function getFormInputs(n){var e,a=[],s=templateParameters.hasOwnProperty(n)?templateParameters[n]:[],o={};for(let t=0;t<s.length;t++){var i=n+"|"+s[t],i=document.getElementById(i);let e=i.value;if(i.tagName.match(/^textarea$/i)&&(e=bytesToBase64((new TextEncoder).encode(e))),i.tagName.match(/^input$/i)&&"checkbox"===i.getAttribute("type")&&(e=i.checked),i.tagName.match(/^select$/i)&&-1<i.selectedIndex){var l=i.options[i.selectedIndex];if(l.hasAttributes())for(var r of l.attributes)excludedAttributes.indexOf(r.name)<0&&(o[s[t]+"-"+r.name]=r.value)}if(i.hasAttributes())for(var d of i.attributes)excludedAttributes.indexOf(d.name)<0&&(o[s[t]+"-"+d.name]=d.value);l={ParameterKey:s[t],ParameterValue:e,ResolvedValue:String(e).match("^/")?e:null,UsePreviousValue:!1};a.push(l)}for(e in o){var t={ParameterKey:e,ParameterValue:o[e],ResolvedValue:o[e],UsePreviousValue:!1};a.push(t)}return a}function cancelInstall(e){unlockInstallButton(e),closeConfirmationModal()}async function deployCfnTemplate(a,e=0,t=!1){if(window.loggedIn){var s=kitMetadata[a],o=s.Templates,n=getFormInputs(a),i=[],l=[];for(let e=0;e<o.length;e++){var r=[],d=await window.getFileFromFileHost("kits/cfn-templates/"+o[e]);if(d.hasOwnProperty("Parameters"))for(var c in d.Parameters)for(let e=0;e<n.length;e++)n[e].ParameterKey===c&&r.push(n[e]);var u=s.hasOwnProperty("stackNamingParam")?s.stackNamingParam:null,u=window.deriveCfnStackName(o[e],r,u);i.push(u),l[e]=[u,r,d]}var m=stacksToBeUpdated(i);if(kitMetadata[a].AllowUpdates&&0<m.length&&!t)showConfirmationModal(!0,"Are you sure?",`You are going to update the stack${1<m.length?"s":""} <b>${m.join(" and ")}</b>. <p>Click Confirm to continue or Cancel.</p>`,deployCfnTemplate,cancelInstall,[a,e,!0]);else if(!kitMetadata[a].AllowUpdates&&0<m.length&&!t)showConfirmationModal(!0,"Unsupported Stack Update",`If you proceed we will attempt to update the stack${1<m.length?"s":""} <b>${m.join(" and ")}</b>. This may fail. <p>Click Confirm to continue or Cancel.</p>`,deployCfnTemplate,cancelInstall,[a,e,!0]);else for(let n=0;n<o.length;n++){var p=l[n][0],g=l[n][1],E=l[n][2];if(e===n){var h=getValueInNamespace(account+"-"+region,"SourceBucket");(!(51999<JSON.stringify(E).length)||""!==h)&&(startMonitoring(),phoneHome({action:"deploy-cfn-kit",kit_id:a,starter_kit:o[n],details:g}),window.deployCloudFormationTemplate(a,o[n],p,g,h,s,deployResponseHandler,t))}else if(0<n&&n>e){let t=l[n-1][0];addEventListener(TASK_EVENTS.DEPLOYMENT_COMPLETE,e=>{e.detail===t&&deployCfnTemplate(a,n)})}}}}function stacksToBeUpdated(t){var n,a=[];for(n in allStacks)for(let e=0;e<t.length;e++)(t[e].hasOwnProperty("name")&&allStacks[n].StackName===t[e].name||allStacks[n].StackName===t[e])&&a.push(allStacks[n].StackName);return a}async function deployCdkApp(e,t=!1){var n,a,s;window.loggedIn&&(n=kitMetadata[e],a=getFormInputs(e),s=stacksToBeUpdated(await window.deriveCdkStackNames(n,a)),kitMetadata[e].AllowUpdates&&0<s.length&&!t?showConfirmationModal(!0,"Are you sure?",`You are going to update ${s.join(" and ")} - click Confirm to continue or Cancel.`,deployCdkApp,cancelInstall,[e,!0]):!kitMetadata[e].AllowUpdates&&0<s.length&&!t?showConfirmationModal(!0,"Unsupported Stack Update",`If you proceed we will attempt to update the stack${1<s.length?"s":""} <b>${s.join(" and ")}</b>. This may fail. <p>Click Confirm to continue or Cancel.</p>`,deployCdkApp,cancelInstall,[e,!0]):(""===(s=getValueInNamespace(account+"-"+region,"SourceBucket"))&&alert("No source bucket available"),startMonitoring(),phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:e,action:"deploy-cdk-kit",partner_name:window.resellerConfig.AWSDistributorName,country_code:window.resellerConfig.CountryCode,starter_kit:n.Manifest,details:a}),window.deployCdkViaSourceBucket(e,n,a,region,account,s,deployResponseHandler,t)))}function destroyStack(i){window.loggedIn&&window.listStacks((e,t)=>{if(!e){allStacks={};for(let e=0;e<t.Stacks.length;e++)allStacks[t.Stacks[e].StackId]=t.Stacks[e];for(var n in allStacks)if(evaluateStatus(allStacks[n].StackStatus)===TASK_STATES.FAILED_NEEDS_DELETION){var a,s=allStacks[n].Tags,o={};for(let e=0;e<s.length;e++)o[s[e].Key]=s[e].Value;o.hasOwnProperty("KitId")&&(a=getFromKitMetadata(o.KitId))&&a.name===i&&window.deleteStack(allStacks[n].StackName,(e,t)=>{})}}})}window.amis={},window.amis.windows=[],window.amis.linux2=[],window.amis.linuxArm=[],window.amis.ubuntu=[],window.amis.ubuntuArm=[],window.amis.linux2023=[],window.amis.linux2023Arm=[],window.amis.rhel=[],window.amis.rhelArm=[];let latestRhels={};function removeOldRhelAmis(t){for(let e=0;e<t.length;e++){var n,a=t[e].Name.match(/_HA/)?" (HA)":"",s=t[e].Name.match(/_GA/)?" (GA)":"",o=`(${t[e].Architecture})`;t[e].Name=t[e].Name.replace(/^RHEL_HA/,"RHEL~HA"),t[e].Name.match(/SQL_/)?(a=`RHEL SQL${a} ${t[e].Name.split("-")[0].split("_")[1]}${s} `+o,n=parseInt(t[e].Name.split("-")[3].replace(/\D/g),10),(!latestRhels.hasOwnProperty(a)||latestRhels[a][0]<n)&&(latestRhels[a]=[n,t[e]])):t[e].Name.match(/^RHEL~HA/)?(a=`RHEL (HA) ${t[e].Name.split("-")[1].split("_")[0]} ${s} `+o,n=parseInt(t[e].Name.split("-")[2],10),(!latestRhels.hasOwnProperty(a)||latestRhels[a][0]<n)&&(latestRhels[a]=[n,t[e]])):t[e].Name.match(/^RHEL-/)&&(a=`RHEL ${t[e].Name.split("-")[1].split("_")[0]} ${s} `+o,s=parseInt(t[e].Name.split("-")[2],10),!latestRhels.hasOwnProperty(a)||latestRhels[a][0]<s)&&(latestRhels[a]=[s,t[e]])}var e,i=[];for(e in latestRhels)latestRhels[e][1].Name=e,i.push(latestRhels[e][1]);return i}function fetchAmis(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"amiDataLastFetch"));if(t&&60<e-t&&e-86400<t){t=getValueInNamespace(region,"amiData");if(""!==t)return window.amis=JSON.parse(t),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"amiDataLastFetch",e),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*arm64-server*"]},{Name:"description",Values:["Canonical, Ubuntu*LTS*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]},{Name:"owner-id",Values:["099720109477"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(!n.Images[t].Name.match("daily")&&!n.Images[t].Name.match("eks")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{8}(\.\d)*/,"");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var l,r=[];for(l in t)r.push(t[l]);window.amis.ubuntuArm=r,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Owners:["309956199498","199830906635"],IncludeDeprecated:!1,IncludeDisabled:!1,Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["RHEL*"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n=[],a={},s=[],o={},i=removeOldRhelAmis(t.Images);for(let e=0;e<i.length;e++)"arm64"===i[e].Architecture?(s.push(i[e].Name),o[i[e].Name]=i[e]):(n.push(i[e].Name),a[i[e].Name]=i[e]);n.sort().reverse();var l={};for(let e=0;e<n.length;e++){var r=a[n[e]];r.ShortName=r.Name,l[r.Name]=r}var d,c=[];for(d in l)c.push(l[d]);window.amis.rhel=c,s.sort().reverse();var u={};for(let e=0;e<s.length;e++){var m=o[s[e]];m.ShortName=m.Name,u[m.Name]=m}var p,g=[];for(p in u)g.push(u[p]);window.amis.rhelArm=g,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*server*"]},{Name:"description",Values:["Canonical, Ubuntu*LTS*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]},{Name:"owner-id",Values:["099720109477"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(!n.Images[t].Name.match("daily")&&!n.Images[t].Name.match("eks")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{8}(\.\d)*/,"");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var l,r=[];for(l in t)r.push(t[l]);window.amis.ubuntu=r,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"platform",Values:["windows"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(n.Images[t].Name.match("English")&&!n.Images[t].Name.match("EKS")&&!n.Images[t].Name.match("ECS")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{4}\.\d{2}\.\d{2}/,"").replace(/[\W_]/g," ");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var l,r=[];for(l in t)r.push(t[l]);window.amis.windows=r,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*al2023*"]},{Name:"description",Values:["Amazon Linux*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],l=i.Name.replace(/-\d{4}\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(l)||(o[i.ShortName=l]=i)}var r,d=[];for(r in o)d.push(o[r]);window.amis.linux2023=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*al2023*"]},{Name:"description",Values:["Amazon Linux*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],l=i.Name.replace(/-\d{4}\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(l)||(o[i.ShortName=l]=i)}var r,d=[];for(r in o)d.push(o[r]);window.amis.linux2023Arm=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*amzn2*"]},{Name:"description",Values:["Amazon Linux 2*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],l=i.Name.replace(/-\d\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(l)||(o[i.ShortName=l]=i)}var r,d=[];for(r in o)d.push(o[r]);window.amis.linux2=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*amzn2*"]},{Name:"description",Values:["Amazon Linux 2*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],l=i.Name.replace(/-\d\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(l)||(o[i.ShortName=l]=i)}var r,d=[];for(r in o)d.push(o[r]);window.amis.linuxArm=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}})}function cacheAmiData(){setValueInNamespace(region,"amiData",JSON.stringify(window.amis))}addEventListener("AMI_DATA_UPDATE",cacheAmiData),window.instanceTypes={};let instanceTypeNames=[];function resetAmiInstanceTypeLists(){instanceTypeNames=[],window.instanceTypes={},window.amis={},window.amis.windows=[],window.amis.linux2=[],window.amis.linuxArm=[],window.amis.ubuntu=[],window.amis.ubuntuArm=[],window.amis.linux2023=[],window.amis.linux2023Arm=[]}function getInstanceTypes(e){var t=Math.round((new Date).getTime()/1e3),n=Number(getValueInNamespace(region,"instanceDataLastFetch"));if(!e&&n&&60<t-n&&t-86400<n){n=getValueInNamespace(region,"instanceData");if(""!==n)return window.instanceTypes=JSON.parse(n),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"instanceDataLastFetch",t);n={Filters:[{Name:"instance-type",Values:["*"]},{Name:"bare-metal",Values:["false"]},{Name:"current-generation",Values:["true"]},{Name:"supported-virtualization-type",Values:["hvm"]}]};e&&(n.NextToken=e),window.describeInstanceTypes(n,(e,t)=>{if(!e){for(let e=0;e<t.InstanceTypes.length;e++){var n;!t.InstanceTypes[e].InstanceType.match(/(flex|u-|hpc)/)&&t.InstanceTypes[e].InstanceType.match(/^[a-z][\d\w]{1,5}\./)&&(n=t.InstanceTypes[e].InstanceType.split(".")[0],n=(n+=String(t.InstanceTypes[e].VCpuInfo.DefaultVCpus).padStart(3,"0"))+String(t.InstanceTypes[e].MemoryInfo.SizeInMiB).padStart(4,"0"),instanceTypeNames.push(n+"-"+t.InstanceTypes[e].InstanceType),window.instanceTypes[t.InstanceTypes[e].InstanceType]=t.InstanceTypes[e])}instanceTypeNames.sort();var a={};for(let e=0;e<instanceTypeNames.length;e++){var s=instanceTypeNames[e].split("-")[1];a[s]=window.instanceTypes[s]}t.NextToken?(dispatchEvent(new Event("EXTEND_LOAD_DELAY")),getInstanceTypes(t.NextToken)):(window.instanceTypes=a,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("INSTANCE_DATA_UPDATE")))}})}function cacheInstanceData(){setValueInNamespace(region,"instanceData",JSON.stringify(window.instanceTypes))}function resetDbInfraLists(){window.dbEngines={},window.serverlessDbEngines={},window.dbInstances={}}function getAllDbEngines(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"dbEngineLastFetch"));if(t&&60<e-t&&e-86400<t){var t=getValueInNamespace(region,"dbEngines"),n=getValueInNamespace(region,"serverlessDbEngines");if(""!==t)return window.dbEngines=JSON.parse(t),window.serverlessDbEngines=JSON.parse(n),getAllDbInstances(),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"dbEngineLastFetch",e),window.describeDatabaseEngines({},(e,t)=>{if(t){for(var n in window.dbEngines=t,window.dbEngines)for(var a in window.dbEngines[n])window.dbEngines[n][a].hasOwnProperty("SupportedEngineModes")&&window.dbEngines[n][a].SupportedEngineModes.includes("serverless")&&(window.serverlessDbEngines.hasOwnProperty(n)||(window.serverlessDbEngines[n]={}),window.serverlessDbEngines[n].hasOwnProperty(a)||(window.serverlessDbEngines[n][a]={}),window.serverlessDbEngines[n][a]=window.dbEngines[n][a]);setValueInNamespace(region,"dbEngines",JSON.stringify(window.dbEngines)),setValueInNamespace(region,"serverlessDbEngines",JSON.stringify(window.serverlessDbEngines)),getAllDbInstances()}})}function getAllDbInstances(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"dbInstancesLastFetch"));if(t&&60<e-t&&e-86400<t){t=getValueInNamespace(region,"dbInstances");if(""!==t)return window.dbInstances=JSON.parse(t),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"dbInstancesLastFetch",e);for(let n in window.dbEngines)window.describeDatabaseInstances(n,(e,t)=>{t&&(window.dbInstances[n]=t[n],setValueInNamespace(region,"dbInstances",JSON.stringify(window.dbInstances)))})}function runSdkCommand(){document.getElementById("sdk-output").hidden=!1;try{switch(document.getElementById("sdk-commands-list").value){case"list-buckets":window.listBuckets(function(e,n){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{let t="";for(let e=0;e<n.Buckets.length;e++)t+="* "+n.Buckets[e].Name+"<br>\n";document.getElementById("sdk-result").innerText=preformatted(t,!1)}});break;case"list-subnets":window.getSubnets(function(e,n){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{let t="";for(let e=0;e<n.Subnets.length;e++)t+="* "+n.Subnets[e].SubnetId+" | "+n.Subnets[e].VpcId+" | "+n.Subnets[e].CidrBlock+" | "+n.Subnets[e].AvailabilityZone+"<br>\n";document.getElementById("sdk-result").innerText=preformatted(t,!1)}});break;case"get-credential-report":window.getCredentialReport(function(e,t){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{var e=new TextDecoder("utf-8").decode(t.Content).replace(/[<>]/g,"").split("\n"),n=e[0].split(","),a=e[1].split(","),s={};for(let e=0;e<n.length;e++)s[n[e]]=a[e];document.getElementById("sdk-result").innerText=preformatted(s,!0)}});break;case"get-cloudfront-prefix-list":window.getPrefixLists({Filters:[{Name:"prefix-list-name",Values:["com.amazonaws.global.cloudfront.origin-facing"]}]},function(e,t){document.getElementById("sdk-result").innerText=preformatted(e||t,!0)})}}catch(e){document.getElementById("sdk-result").innerText=preformatted(e,!0)}}function preformatted(e,t){return t?(document.getElementById("sdk-result").classList.add("pre"),"[object Object]"===e.toString()?JSON.stringify(e,null,4):e):(document.getElementById("sdk-result").classList.remove("pre"),e)}addEventListener("INSTANCE_DATA_UPDATE",cacheInstanceData),window.dbEngines={},window.serverlessDbEngines={},window.dbInstances={},document.getElementById("execute-sdk-button").addEventListener("click",runSdkCommand);let region=null,account=null,progressBars={},templateParameters={},loadBlockTimeout=null,regionSelected=!1,kitMetadata={},defaultCategory=null,decoder=(document.documentElement.setAttribute("data-theme","light"),new TextDecoder);async function checkForKey(){var e=localStorage.getItem("kitConfig");e?(window.resellerConfig=JSON.parse(e),await fetchConfigForKey()):hideLoadingBlock()}function keyFound(){applyBranding(),document.getElementById("lock-block").hidden=!0,addEventListener("TEXT_LOADED",()=>{resetUi(),tryLogin(),toggleCredentialTypes(),hideLoadingBlock()}),setLanguage()}function reloadConfig(){var e=localStorage.getItem("kitConfig");e&&(window.resellerConfig=JSON.parse(e),fetchConfigForKey())}function purgeConfig(){localStorage.removeItem("kitConfig"),localStorage.removeItem("hosts"),window.api.restartApp()}async function fetchConfigForKey(){var e,t=document.getElementById("key").value||window.resellerConfig.csk_id;window.hasOwnProperty("hosts")||(window.hosts=JSON.parse(window.localStorage.getItem("hosts"))),t.match(/[a-zA-Z0-9]{22}/)&&(e=JSON.stringify({csk_id:t}),e=await(await fetch(`https://${window.hosts.CONFIG_HOST}/app/config/get`,{method:"POST",headers:{"Content-Type":"application/json","x-csk":t},body:e})).arrayBuffer(),(e=JSON.parse(decoder.decode(e))).hasOwnProperty("csk_id"))&&e.csk_id===t?(window.resellerConfig=e,window.resellerConfig.AWSDistributorName=e.BusinessName,window.resellerConfig.KitHubCode=""===e.KitHubCode?"none":e.KitHubCode,localStorage.setItem("kitConfig",JSON.stringify(window.resellerConfig)),dispatchEvent(new Event("KEY_FOUND")),phoneHome({action:`loaded config from key starting with ${t.substring(0,10)}...`})):document.getElementById("key-error").hidden=!1}function applyBranding(){window.hosts=JSON.parse(window.localStorage.getItem("hosts")),window.resellerConfig.distributor.hasOwnProperty("FileHost")&&window.resellerConfig.distributor.FileHost.match(/\w+\.\w+/)&&(window.hosts.FILE_HOST=window.resellerConfig.distributor.FileHost,window.setFileHost(window.hosts.FILE_HOST)),window.resellerConfig.hasOwnProperty("FileHost")&&window.resellerConfig.FileHost.match(/\w+\.\w+/)&&(window.hosts.FILE_HOST=window.resellerConfig.FileHost,window.setFileHost(window.hosts.FILE_HOST)),window.localStorage.setItem("hosts",JSON.stringify(window.hosts)),setTimeout(getAllKitsMetadata,1e3),document.getElementById("companyName").innerText=window.resellerConfig.BusinessName,document.title=window.resellerConfig.BusinessName+" | Cloud Starter Kit",document.getElementById("countryCode").innerText=window.resellerConfig.CountryCode,window.resellerConfig.hasOwnProperty("distributor")&&window.resellerConfig.distributor.hasOwnProperty("LogoUrl")&&(document.getElementById("menu-distie-logo").setAttribute("src",window.resellerConfig.distributor.LogoUrl),document.getElementById("menu-distie-logo").style=window.resellerConfig.distributor.LogoCss,document.title=`${window.resellerConfig.distributor.BusinessName} | ${window.resellerConfig.BusinessName} | Cloud Starter Kit`,document.getElementById("company-logo-creds").style=window.resellerConfig.distributor.LogoCss,document.getElementById("company-logo-creds").setAttribute("src",window.resellerConfig.distributor.LogoUrl)),window.resellerConfig.hasOwnProperty("LogoUrl")&&(document.getElementById("company-logo-left-menu").setAttribute("src",window.resellerConfig.LogoUrl),window.resellerConfig.LogoUrl.match(/no-csk-logo.png$/)||document.getElementById("company-logo-creds").setAttribute("src",window.resellerConfig.LogoUrl)),window.resellerConfig.hasOwnProperty("LogoCss")?(document.getElementById("company-logo-left-menu").style=window.resellerConfig.LogoCss,window.resellerConfig.LogoUrl.match(/no-csk-logo.png$/)||(document.getElementById("company-logo-creds").style=window.resellerConfig.LogoCss)):(window.resellerConfig.hasOwnProperty("LogoCssLeft")&&(document.getElementById("company-logo-left-menu").style=window.resellerConfig.LogoCssLeft),window.resellerConfig.hasOwnProperty("LogoCssRight")&&(document.getElementById("company-logo-creds").style=window.resellerConfig.LogoCssRight))}addEventListener("KEY_FOUND",keyFound);let lastData=null;async function phoneHome(e){if(window.hosts){e.csk_id=window.resellerConfig.csk_id,e.partner_name=window.resellerConfig.AWSDistributorName,e.country_code=window.resellerConfig.CountryCode;e=JSON.stringify(e);if(lastData!==e){lastData=e;try{var t=lastData,n=await fetch(`https://${window.hosts.ADMIN_HOST}/app/reporting/report`,{method:"POST",headers:{"Content-Type":"application/json","x-csk":window.resellerConfig.csk_id},body:t});await n.arrayBuffer()}catch(e){}}}}function tryLogin(){window.checkIfCredsAvailable(credentialsCallback)}function addCredentials(){let e=document.getElementById("pasted-credentials").value;document.getElementById("access-key-id").value&&document.getElementById("secret-access-key").value&&(e="AWS_ACCESS_KEY_ID="+document.getElementById("access-key-id").value+"\nAWS_SECRET_ACCESS_KEY="+document.getElementById("secret-access-key").value+"\n"),window.setCredentials(e,credentialsCallback)}function credentialsCallback(e,t){if(e)displayCredentialErrors(!0,e),document.getElementById("pasted-credentials").value="";else if(t){window.loggedIn=!0,phoneHome({action:"logged in"}),displayCredentialErrors(!1),displaySessionErrors(null,t),account!==t.AWS_ACCOUNT_ID&&(phoneHome({action:"switched account"}),resetAllKitMonitors(),resetStackMonitoring()),account=t.AWS_ACCOUNT_ID;let e="";for(var n in t)e+="<b>"+n+"</b>: "+t[n]+"<br/>\n";document.getElementById("credentials-block").hidden=!0,document.getElementById("account-display").innerText=account,lockRegionControls(!0),showPrepareRegionModal(!0),showAliasForAccount(account),populateRegionsSelect(),extendLoadDelay();try{resetAllKitMonitors(),switchLeftMenuItem({target:{id:"install-a-kit-button",content:"starter-kits"}})}catch(e){}}}function showAliasForAccount(e){var t=getValueInNamespace(e,"alias");t?document.getElementById("account-alias").innerText=t:writeInputForAlias(e)}function resetAlias(){writeInputForAlias(account)}function writeInputForAlias(t){setValueInNamespace(t,"alias",""),document.getElementById("account-alias").innerText="";let n=document.createElement("input");n.type="text",n.id="account-alias-input",n.placeholder="Account owner...",n.onkeyup=e=>{"Enter"!==e.key&&13!==e.keyCode||(setValueInNamespace(t,"alias",n.value),document.getElementById("account-alias").innerText=n.value)},document.getElementById("account-alias").appendChild(n)}let kitConfigsShowing={};function configureKit(e){var t=kitMetadata[e],t=(kitConfigsShowing[e]=!0,(t.hasOwnProperty("Templates")?displayTemplateConfig:displayCdkAppConfig)(e),document.getElementById(e+"-config-pane")),n=document.getElementById(e+"-config-button"),a=document.getElementById(e+"-install-button"),e=document.getElementById(e+"-cancel-button");t&&(t.style.display="block",n.style.display="none",a.style.display="block",e.style.display="block")}function hideConfigForKit(e){var t=document.getElementById(e+"-config-pane"),n=document.getElementById(e+"-config-button"),a=document.getElementById(e+"-install-button"),s=document.getElementById(e+"-cancel-button");t&&(t.style.display="none",n.style.display="block",a.style.display="none",s.style.display="none",delete kitConfigsShowing[e])}function installKit(e){var t=kitMetadata[e];document.getElementById(e+"-install-button")&&(document.getElementById(e+"-install-button").disabled=!0),document.getElementById(e+"-deployment-progress").style.display="block",toggleDeploymentDetails(e,!0),(t.hasOwnProperty("Templates")?deployCfnTemplate:deployCdkApp)(e)}function reenableKitButton(e){document.getElementById(e+"-install-button")&&(document.getElementById(e+"-install-button").disabled=!1)}function showDeleteKitButton(e){document.getElementById(e+"-delete-button")&&(document.getElementById(e+"-delete-button").style.display="inline")}function deleteKit(e){var t=kitMetadata[e];document.getElementById(e+"-delete-button").disabled=!0,(t.hasOwnProperty("Templates")?deleteCfnStack:destroyCdkApp)(e)}function deleteCfnStack(e){}function destroyCdkApp(e){}function showCategory(e){var t,n=document.getElementById(e);n.style.display="block";for(t of n.parentNode.children)t!==n&&(t.style.display="none");var a,s=document.getElementById(e+"-selector"),e=(s.classList.add("category-selector-selected"),document.getElementById("kit-category-selector"));for(a of e.children)a!==s&&a.classList.remove("category-selector-selected")}function toggleDeploymentDetails(e,t=!1){e=document.getElementById(e+"-deployment-details");t||"none"===e.style.display?e.style.display="block":e.style.display="none"}function getAllKitsMetadata(){window.getFullCatalogue(i=>{var l,e=document.getElementById("starter-kits"),t=document.createElement("div"),n=(t.classList.add("category-container"),e.appendChild(t),document.createElement("div")),a=(n.classList.add("scrollable"),e.appendChild(n),[]);for(l in i){var r,s=l.toLowerCase().replaceAll(/\s/g,"-"),o=(defaultCategory=defaultCategory||s,document.createElement("div")),d=(o.classList.add("category-selector"),o.id=s+"-selector",document.createElement("a")),c=(d.innerText=l,o.appendChild(d),o.setAttribute("onclick",`showCategory('${s}')`),a.push(o),document.createElement("div")),d=(c.className="top-level-category",c.id=s,c.style.display="none",document.createElement("h2")),o=(d.classList.add("heading"),d.innerText=l,document.createElement("p"));for(r in appendHtmlToNode(o,i[l].Description),c.appendChild(d),c.appendChild(o),i[l].Categories){var u=document.createElement("h3"),m=(u.classList.add("sub-heading"),u.innerText=r,document.createElement("p"));m.classList.add("category-description"),appendHtmlToNode(m,i[l].Categories[r].Description),c.appendChild(u),c.appendChild(m);for(let o=0;o<i[l].Categories[r].Kits.length;o++){var p=i[l].Categories[r].Kits[o];let e="cfn";var g=(e=p.hasOwnProperty("Manifest")?"cdk":e)+"-"+p.Name.toLowerCase().replace(/\s/g,"-").replace(/[^a-zA-Z0-9\-]/g,""),E=document.createElement("div"),h=(E.className="kit",E.id=g,document.createElement("h4"));h.classList.add("sub-sub-heading");let t=p.Name;(kitMetadata[g]=p).hasOwnProperty("UploadRequired")&&(t+=" ü™£"),p.hasOwnProperty("AllowUpdates")&&p.AllowUpdates&&(t+=" üîÅ"),p.hasOwnProperty("VpcRequired")&&p.VpcRequired&&(t+=" ‚òÅÔ∏è"),h.innerText=t;var w=document.createElement("p");appendHtmlToNode(w,p.Description.replaceAll("<br>","</p><p>"));let n=null,a=(p.hasOwnProperty("CostCalculator")&&p.CostCalculator&&((n=document.createElement("p")).classList.add("cost-calculator"),(f=document.createElement("a")).setAttribute("href",p.CostCalculator),f.setAttribute("target","_blank"),f.innerText="Cost Calculator",n.appendChild(f)),null),s=(p.hasOwnProperty("Copyright")&&p.Copyright&&((a=document.createElement("p")).classList.add("copyright"),a.innerText=p.Copyright),null);p.hasOwnProperty("MoreInfo")&&p.MoreInfo&&((s=document.createElement("div")).classList.add("kit-more-info"),appendHtmlToNode(s,p.MoreInfo));var f=document.createElement("button"),y=(f.id=g+"-config-button",f.innerText="Configure "+p.Name,f.setAttribute("onclick",`configureKit('${g}')`),document.createElement("button")),k=(y.id=g+"-install-button",y.innerText="Install "+p.Name,y.setAttribute("onclick",`installKit('${g}')`),y.style.display="none",document.createElement("button")),p=(k.id=g+"-update-button",k.innerText="Update "+p.Name,k.setAttribute("onclick",`installKit('${g}')`),k.style.display="none",document.createElement("button")),k=(p.id=g+"-delete-button",p.innerText="Delete",p.setAttribute("onclick",`deleteKit('${g}')`),p.style.display="none",document.createElement("button")),I=(k.id=g+"-cancel-button",k.innerText="Cancel",k.setAttribute("onclick",`hideConfigForKit('${g}')`),k.style.display="none",k.style.float="right",document.createElement("div")),S=(I.id=g+"-config-pane",document.createElement("p")),S=(S.innerText="Loading configuration options for this kit - please wait.",I.appendChild(S),I.style.display="none",document.createElement("div")),v=(S.classList.add("logs"),S.id=g+"-deployment-progress",document.createElement("div")),T=(v.classList.add("progress-bar-striped"),v.setAttribute("onclick",`toggleDeploymentDetails('${g}')`),v.id=g+"-deployment-progress-bar",document.createElement("div")),A=(T.style.width="100%",document.createElement("b")),b=document.createElement("p"),A=(A.appendChild(b),T.appendChild(A),v.appendChild(T),document.createElement("p")),v=(A.classList.add("progress-bar-message"),S.appendChild(v),S.appendChild(A),progressBars[g]=[b,T,A],document.createElement("div")),b=(v.id=g+"-deployment-details",document.createElement("h5")),T=(b.innerText="Deployment Request Response",v.appendChild(b),document.createElement("div")),A=(T.id=g+"-deploystack-output",T.classList.add("output","pre"),v.appendChild(T),document.createElement("h5")),b=(A.innerText="CloudFormation Events",v.appendChild(A),document.createElement("div")),T=(b.id=g+"-cf-stack-states",b.classList.add("output"),v.appendChild(b),document.createElement("h5")),A=(T.innerText="Stack Outputs",v.appendChild(T),document.createElement("div"));A.id=g+"-cf-stack-outputs",A.classList.add("output"),v.appendChild(A),v.style.display="none",S.appendChild(v),S.style.display="none",E.appendChild(h),(kitDescColumns=document.createElement("div")).classList.add("kit-desc-columns"),kitDescColumns.appendChild(w),a&&w.appendChild(a),n&&w.appendChild(n),s&&kitDescColumns.appendChild(s),E.appendChild(kitDescColumns),E.appendChild(f),E.appendChild(I),E.appendChild(k),E.appendChild(y),E.appendChild(p),E.appendChild(S),c.appendChild(E)}}n.appendChild(c)}t.style.columns=a.length,t.id="kit-category-selector";for(let e=0;e<a.length;e++)t.appendChild(a[e]);showCategory(defaultCategory)})}function populateRegionsSelect(){window.getRegions((e,n)=>{if(!e){for(var a=getValueInNamespace(account,"SelectedRegion")||window.resellerConfig.DefaultRegion,s=document.getElementById("region-select");s.firstChild;)s.removeChild(s.firstChild);let t=!1;var o=[],i={};for(let e=0;e<n.Regions.length;e++){var l=convertRegionCodeToName(n.Regions[e].RegionName);o.push(l),i[l]=n.Regions[e].RegionName}o.sort();for(let e=0;e<o.length;e++){i[o[e]]===a&&(t=!0);var r=document.createElement("option");r.text=o[e],r.value=i[o[e]],s.add(r)}t?s.value=a:(s.value="ap-southeast-2",displayErrors(`Region ${a} is not available, probably because it is an opt-in Region. Click the link to open the AWS console and resolve this.`,"https://us-east-1.console.aws.amazon.com/billing/home?region=us-east-1#/account")),updateRegion()}})}function afterRegionOptIn(e,t){}function hideLoadingBlock(){document.getElementById("loading-block").style.display="none"}let allowedVpcs={},hasAllowedVpcs=!1;function updateVpcs(){window.getVpcs((e,t)=>{if(!e){window.vpcs=t.Vpcs;for(let e=0;e<window.vpcs.length;e++)!1===window.vpcs[e].IsDefault&&"available"===window.vpcs[e].State&&(allowedVpcs[window.vpcs[e].VpcId]=window.vpcs[e],hasAllowedVpcs=!0);vpcStatus(),hasAllowedVpcs&&window.getSubnets((e,t)=>{if(!e){var n,a,s={},o=[];for(let e=0;e<t.Subnets.length;e++)s.hasOwnProperty(t.Subnets[e].VpcId)||(s[t.Subnets[e].VpcId]=[]),s[t.Subnets[e].VpcId].push(t.Subnets[e]);for(n in s){for(let t=0;t<s[n].length;t++)for(let e=0;e<s[n].length;e++)s[n][t].AvailabilityZone<s[n][e].AvailabilityZone&&(a=s[n][t],s[n][t]=s[n][e],s[n][e]=a);for(var i=0;i<s[n].length;i++)o.push(s[n][i])}window.subnets=o,dispatchEvent(new Event("UI_DATA_UPDATE"))}})}})}function fetchKeyPairs(){window.getEc2KeyPairs((e,t)=>{e||(window.keyPairs=t.KeyPairs,dispatchEvent(new Event("UI_DATA_UPDATE")))})}function createKeyPair(){addToTaskQueue(new Task(TASK_TYPES.CREATE_KEY,"create-key-pair")),window.generateKeyPair(document.getElementById("region-select").value,(e,t)=>{e||(window.keyPairs.push(t),dispatchEvent(new Event("KEY_READY")),dispatchEvent(new Event("UI_DATA_UPDATE")),window.api.saveFile(t.KeyName,t.KeyMaterial))})}function extendLoadDelay(e=3e3){loadBlockTimeout&&clearTimeout(loadBlockTimeout),loadBlockTimeout=setTimeout(()=>{dispatchEvent(new Event(TASK_EVENTS.LOADING_COMPLETE))},e)}function checkDeliveryStackCompleteness(){let a=setInterval(function(n){window.getStackStatus(n,(e,t)=>{if(!e&&t.hasOwnProperty("Stacks")&&t.Stacks[0].hasOwnProperty("StackStatus")&&"CREATE_COMPLETE"===t.Stacks[0].StackStatus){if(0<t.Stacks[0].Outputs.length)for(let e=0;e<t.Stacks[0].Outputs.length;e++)"CskSourceBucketName"===t.Stacks[0].Outputs[e].ExportName?setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[e].OutputValue):"CskPipelineName"===t.Stacks[0].Outputs[e].ExportName&&setValueInNamespace(account+"-"+region,"PipelineName",t.Stacks[0].Outputs[e].OutputValue);dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:n})),clearInterval(a)}})},5e3,"csk-cdk-app-delivery-pipeline-stack")}function lockRegionControls(e){document.getElementById("region-select").disabled=e,document.getElementById("switch-accounts-button").hidden=e}function closeConfirmationModal(){showConfirmationModal(!1)}function showConfirmationModal(e,t,n,a,s,o){e?(document.getElementById("confirm-block").style.display="block",document.getElementById("confirm-message").innerText=t,document.getElementById("confirm-details").innerText=n,appendHtmlToNode(document.getElementById("confirm-details"),n),document.getElementById("background-view").style.filter="blur(4px)",document.getElementById("confirm-ok-button").addEventListener("click",()=>{a(...o),closeConfirmationModal()}),document.getElementById("confirm-cancel-button").addEventListener("click",()=>{s(...o)})):(document.getElementById("background-view").style.filter="none",document.getElementById("confirm-block").style.display="none")}function showPrepareRegionModal(e){e?(document.getElementById("modal-block").style.display="block",document.getElementById("modal-message").innerText="Preparing Region...",document.getElementById("background-view").style.filter="blur(4px)"):(document.getElementById("background-view").style.filter="none",document.getElementById("modal-block").style.display="none")}function updateRegion(e=0){region=document.getElementById("region-select").value,document.getElementById("region-map").setAttribute("src",`images/world_map-${region}.svg`),window.setRegion(region),setValueInNamespace(account,"SelectedRegion",region),lockRegionControls(!0),showPrepareRegionModal(!0),addToTaskQueue(new Task(Task.TYPES.REGIONAL_DATA_LOADING,region)),addToTaskQueue(new Task(Task.TYPES.REGIONAL_PIPELINE_BUILD,region));let t=setInterval(()=>{regionControlsCanBeUnlocked()&&(lockRegionControls(!1),showPrepareRegionModal(!1),clearInterval(t))},3e3);window.prepareRegion((e,t)=>{if(t&&t.hasOwnProperty("Stacks")&&0<t.Stacks[0].Outputs.length){for(let e=0;e<t.Stacks[0].Outputs.length;e++)"CskSourceBucketName"===t.Stacks[0].Outputs[e].ExportName?setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[e].OutputValue):"CskPipelineName"===t.Stacks[0].Outputs[e].ExportName&&setValueInNamespace(account+"-"+region,"PipelineName",t.Stacks[0].Outputs[e].OutputValue);dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:"csk-cdk-app-delivery-pipeline-stack"}))}else t&&t.hasOwnProperty("StackId")&&t.StackId.match("csk-cdk-app-delivery-pipeline-stack")?checkDeliveryStackCompleteness():e&&(displayErrors("Error creating delivery pipeline: "+e.message),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:"csk-cdk-app-delivery-pipeline-stack"})))}),regionSelected=!0,listAllStacks(),allowedVpcs={},hasAllowedVpcs=!1,updateVpcs(),getManagedPrefixLists(),getExistingVpcEndpoints(),getExistingInstanceConnectEndpoints(),fetchKeyPairs(),resetAmiInstanceTypeLists(),fetchAmis(),getInstanceTypes(),resetDbInfraLists(),getAllDbEngines(),getAccountHostedZones(),resetAllKitMonitors()}addEventListener("POST_STACK_UPDATE",updateVpcs),addEventListener("UI_DATA_UPDATE",()=>{extendLoadDelay(1e3)}),addEventListener("EXTEND_LOAD_DELAY",()=>{extendLoadDelay(3e3)});let managedPrefixLists={};function getManagedPrefixLists(){managedPrefixLists={},window.getPrefixLists({},function(e,t){if(!e)for(let e=0;e<t.PrefixLists.length;e++){var n;"AWS"===t.PrefixLists[e].OwnerId&&"create-complete"===t.PrefixLists[e].State&&(n="origin-facing"===(n=t.PrefixLists[e].PrefixListName.split(".").pop())?"cloudfront":n,managedPrefixLists[n]=t.PrefixLists[e].PrefixListId)}})}let vpcEndpoints={};function getExistingVpcEndpoints(){vpcEndpoints={},window.getVpcEndpoints({},function(e,t){if(!e)for(let e=0;e<t.VpcEndpoints.length;e++)"available"===t.VpcEndpoints[e].State&&(vpcEndpoints.hasOwnProperty(t.VpcEndpoints[e].VpcId)||(vpcEndpoints[t.VpcEndpoints[e].VpcId]={}),vpcEndpoints[t.VpcEndpoints[e].VpcId][t.VpcEndpoints[e].ServiceName]=t.VpcEndpoints[e].VpcEndpointId)})}let instanceConnectEndpoints={};function getExistingInstanceConnectEndpoints(){instanceConnectEndpoints={},window.getEc2InstanceConnectEndpoints({},function(e,t){if(!e)for(let e=0;e<t.InstanceConnectEndpoints.length;e++)"create-complete"===t.InstanceConnectEndpoints[e].State&&(instanceConnectEndpoints[t.InstanceConnectEndpoints[e].VpcId]=t.InstanceConnectEndpoints[e])})}let hostedZones={};function getAccountHostedZones(){hostedZones={},window.getHostedZones({},function(e,t){if(!e)for(let e=0;e<t.HostedZones.length;e++)hostedZones[t.HostedZones[e].Id.split("/").pop()]=t.HostedZones[e].Name.replace(/\.$/,"")})}function getCurrentValues(t){var n={},a=templateParameters.hasOwnProperty(t)?templateParameters[t]:[];for(let e=0;e<a.length;e++)n[a[e]]=document.getElementById(t+"|"+a[e]).value;return n}function kitIsUpdateable(e){return kitMetadata[e].AllowUpdates}let previousConfig={};async function getExistingConfigs(n){var e=getValueInNamespace(account+"-"+region,"SourceBucket");let t=[];""!==e&&(t=await window.fetchKitConfig(n,e));var e=document.createElement("div"),a=(e.style.whiteSpace="nowrap",document.createElement("label")),s=(a.innerText="Previous configs:",e.appendChild(a),document.createElement("select")),o=(s.style.width="60%",s.id=n+"-existing-configs",getValueInNamespace(account+"-"+region,"SourceBucket"));for(let e=0;e<t.length;e++){var i=document.createElement("option");i.text=t[e][0],i.value=await getTextFileFromBucket(o,t[e][1]),s.appendChild(i)}e.appendChild(s);var a=document.createElement("button"),l=(a.id=n+"-load-config",a.innerText="Load",document.createElement("button"));return l.id=n+"-revert-config",l.innerText="Revert",l.style.display="none",e.appendChild(a),e.appendChild(l),setTimeout(()=>{document.getElementById(n+"-load-config").addEventListener("click",()=>{var e=document.getElementById(n+"-existing-configs").value,t=(kitIsUpdateable(n)&&(document.getElementById(n+"-install-button").innerText="Update "+kitMetadata[n].Name),document.getElementById(n+"-revert-config").style.display="inline-block",JSON.parse(e));for(let e=0;e<t.length;e++)document.getElementById(n+"|"+t[e].ParameterKey)&&(previousConfig[n+"|"+t[e].ParameterKey]=document.getElementById(n+"|"+t[e].ParameterKey).value,"userData"===t[e].ParameterKey?document.getElementById(n+"|"+t[e].ParameterKey).value=atob(t[e].ParameterValue):document.getElementById(n+"|"+t[e].ParameterKey).value=t[e].ParameterValue)}),document.getElementById(n+"-revert-config").addEventListener("click",()=>{for(var e in document.getElementById(n+"-install-button").innerText="Install "+kitMetadata[n].Name,document.getElementById(n+"-revert-config").style.display="none",previousConfig)e.split("|")[0]===n&&(document.getElementById(e).value=previousConfig[e])})},1e3),e.outerHTML}async function displayTemplateConfig(s){var e=kitMetadata[s],o=getCurrentValues(s),i=await getExistingConfigs(s);if(regionSelected){var l=e.Templates,r=e.hasOwnProperty("AmiFilter")?e.AmiFilter:"",d=e.hasOwnProperty("DbEngineFilter")?e.DbEngineFilter:"";let n="<div>",t=(n=(n=(n+=i)+`<input id="AWSDistributorName" type="hidden" value="${window.resellerConfig.AWSDistributorName}" name="AWSDistributorName" required>`)+`<input id="CountryCode" type="hidden" value="${window.resellerConfig.CountryCode}" name="CountryCode" required>`+'<input id="ReportingEnabled" type="hidden" value="false" name="ReportingEnabled" required>',!(templateParameters[s]=[])),a="griditemlight";for(let e=0;e<l.length;e++){var c=l[e],u=await(await fetch(`https://${window.hosts.FILE_HOST}/kits/cfn-templates/`+c,{method:"GET",headers:{"x-access-control":JSON.parse(localStorage.getItem("kitConfig")).KitHubCode}})).json();if(u.hasOwnProperty("Metadata")&&u.Metadata.hasOwnProperty("AWS::CloudFormation::Interface")&&u.Metadata["AWS::CloudFormation::Interface"].hasOwnProperty("ParameterGroups")){t=!0;var m=u.Metadata["AWS::CloudFormation::Interface"].ParameterGroups;for(let t=0;t<m.length;t++)if(!m[t].Label.default.match(/Starter-kit Specific Details/i)){n+=makeGroupLabel(m[t].Label.default);for(let e=0;e<m[t].Parameters.length;e++){var p=m[t].Parameters[e];templateParameters[s].push(p),p.match(/AWSDistributorName|ReportingEnabled/)||(n+=makeConfigRow(s,a,p,u.Parameters,r,d,o),a="griditemdark"===a?"griditemlight":"griditemdark")}n+="</div></div>"}}else if(u.hasOwnProperty("Parameters")){for(var g in t=!0,n+='<div class="config">',u.Parameters)templateParameters[s].push(g),g.match(/AWSDistributorName|ReportingEnabled/)||(n+=makeConfigRow(s,a,g,u.Parameters,r,d,o),a="griditemdark"===a?"griditemlight":"griditemdark");n+="</div>"}n+="</div>"}t||(n+='<p class="no-config">No configuration required for this kit.</p>'),appendHtmlToNode(document.getElementById(s+"-config-pane"),n,!0),document.getElementById("create-key-pair-button")&&document.getElementById("create-key-pair-button").addEventListener("click",createKeyPair),setTimeout(filterAmis,200),setTimeout(filterByVpc,200),setTimeout(filterDbInstanceClasses,200)}}function makeConfigRow(e,t,n,a,s,o,i){let l="",r="";a[n].hasOwnProperty("InfoLink")&&(r=`(<a href="${a[n].InfoLink}" target="_blank">more info...</a>)`);var d=a[n].hasOwnProperty("Label")?a[n].Label:n;l=l+`<div class="${t}"><label style="margin: 0px" for="${n}">${d}</label><br><small><i>${a[n].Description} ${r}</i></small><br>`+`</div><div class="${t}">`;try{l+=makeInputElement(e,a[n],n,s,o,i[n])}catch(e){l+="Error rendering input for "+n}return l+="</div>"}function makeHiddenConfigRow(e,t,n,a,s,o){let i="<div class='hidden'></div><div class='hidden'>";try{i+=makeInputElement(e,n[t],t,a,s,o[t])}catch(e){i+="Error rendering input for "+t}return i+="</div>"}function makeGroupLabel(e){var t="";return(t+='<div class="parameter-group">')+`<p class="parameter-heading">${e}</p>`+'<div class="config">'}async function displayCdkAppConfig(s){var e=kitMetadata[s],o=getCurrentValues(s),t=await getExistingConfigs(s);if(regionSelected){var i=e.Manifest,l=e.hasOwnProperty("AmiFilter")?e.AmiFilter:"",r=e.hasOwnProperty("DbEngineFilter")?e.DbEngineFilter:"";if(i){var d=await(await fetch(`https://${window.hosts.FILE_HOST}/kits/cdk-apps/`+i,{method:"GET",headers:{"x-access-control":JSON.parse(localStorage.getItem("kitConfig")).KitHubCode}})).json();let n="<div>",e=(n=(n=(n=n+t+'<div class="config">')+`<input id="AWSDistributorName" type="hidden" value="${window.resellerConfig.AWSDistributorName}" name="AWSDistributorName" required>`)+`<input id="CountryCode" type="hidden" value="${window.resellerConfig.CountryCode}" name="CountryCode" required>`,!1),a=(templateParameters[s]=[],"griditemlight");if(d.hasOwnProperty("ParameterGroups")&&0<Object.keys(d.ParameterGroups).length){e=!0;var c=d.ParameterGroups;for(let t=0;t<c.length;t++){n+=makeGroupLabel(c[t].Label.default);for(let e=0;e<c[t].Parameters.length;e++){var u=c[t].Parameters[e];templateParameters[s].push(u),d.Parameters[u].hasOwnProperty("Hidden")?n+=makeHiddenConfigRow(s,u,d.Parameters,l,r,o):(n+=makeConfigRow(s,a,u,d.Parameters,l,r,o),a="griditemdark"===a?"griditemlight":"griditemdark")}n+="</div></div>"}}else if(d.hasOwnProperty("Parameters")&&0<Object.keys(d.Parameters).length)for(var m in e=!0,d.Parameters)templateParameters[s].push(m),"AWSDistributorName"!==m&&(d.Parameters[m].hasOwnProperty("Hidden")?n+=makeHiddenConfigRow(s,m,d.Parameters,l,r,o):(n+=makeConfigRow(s,a,m,d.Parameters,l,r,o),a="griditemdark"===a?"griditemlight":"griditemdark"));e||(n+='<p class="no-config">No configuration required for this kit.</p>'),n+="</div></div>",appendHtmlToNode(document.getElementById(s+"-config-pane"),n,!0),setTimeout(filterAmis,200),setTimeout(filterByVpc,200),setTimeout(filterDbInstanceClasses,200)}else document.getElementById(s+"-config-pane").innerText="No manifest file found."}}function vpcStatus(){hasAllowedVpcs?document.getElementById("no-vpc-warning").hidden=!0:document.getElementById("no-vpc-warning").hidden=!1}function makeInputElement(e,a,s,t,n,o=null){o&&(a.Default=o);let i="",l=e+"|"+s;if("CSK::PrefixList"===a.Type)managedPrefixLists.hasOwnProperty(a.Service)&&(i+=`<input id="${l}" name="${s}" value="${managedPrefixLists[a.Service]}">`);else if(s.match(/^InstanceType$/i)||"CSK::InstanceType"===a.Type){i=`<select id="${l}" name="${s}" class="instance-type-selector" onchange="filterAmis()">`;let e=null;for(var r in window.instanceTypes){var d=r.split(".")[0];e!==d&&(null!==e&&(i+="</optgroup>"),i+=`<optgroup label="${d}">`,e=d),i+=`<option arch="${window.instanceTypes[r].ProcessorInfo.SupportedArchitectures[0]}" value="${r}">${r} - (${window.instanceTypes[r].ProcessorInfo.SupportedArchitectures[0]}) ${window.instanceTypes[r].VCpuInfo.DefaultVCpus} vCPUs, ${Number(window.instanceTypes[r].MemoryInfo.SizeInMiB)/1024} GB</option>`}i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i+="</optgroup>")+`</select><p style="margin: -5px 2px;"><span id="${l}|suggestX86">x86: `)+`<a onclick="suggestInstance('${l}','XS')">XS</a> | `)+`<a onclick="suggestInstance('${l}','S')">S</a> | `)+`<a onclick="suggestInstance('${l}','M')">M</a> | `)+`<a onclick="suggestInstance('${l}','L')">L</a> | `)+`<a onclick="suggestInstance('${l}','XL')">XL</a></span><span id="${l}|suggestArm"> Arm: `)+`<a onclick="suggestInstance('${l}','XSg')">XS</a> | `)+`<a onclick="suggestInstance('${l}','Sg')">S</a> | `)+`<a onclick="suggestInstance('${l}','Mg')">M</a> | `)+`<a onclick="suggestInstance('${l}','Lg')">L</a> | `)+`<a onclick="suggestInstance('${l}','XLg')">XL</a></span>`)+`</p><p style="margin: -5px 2px; font-weight:bold" id="${l}-message"></p>`}else if(a.hasOwnProperty("AllowedValues"))if(2==a.AllowedValues.length&&1==a.AllowedValues[0]&&0==a.AllowedValues[1]){let e="No label",t="checked";a.hasOwnProperty("CheckboxLabel")&&(e=a.CheckboxLabel),a.hasOwnProperty("Default")&&(t=a.Default?"checked":""),i=`<input class="checkbox" id="${l}" name="${s}" type="checkbox" value="${a.AllowedValues[0]}" ${t}> <label class="checkbox-label" for="">${e}</label>`}else{i=`<select id="${l}" name="${s}">`;for(let e=0;e<a.AllowedValues.length;e++)i+=`<option value="${a.AllowedValues[e]}"`,a.AllowedValues[e]===a.Default&&(i+=" selected"),i+=`>${a.AllowedValues[e]}</option>`;i+="</select>"}else if(a.hasOwnProperty("Type"))if("AWS::EC2::VPC::Id"===a.Type){for(var c in i=`<select id="${l}" name="${s}" class="vpc-selector" onchange="filterByVpc()">`,allowedVpcs){var u=findNameFromTags(allowedVpcs[c].Tags)||allowedVpcs[c].VpcId;i+=`<option value="${allowedVpcs[c].VpcId}">${u} - ${allowedVpcs[c].CidrBlock}</option>`}i+="</select>"}else if("AWS::EC2::Subnet::Id"===a.Type){i=`<select id="${l}" name="${s}" class="subnet-selector">`;let t=window.subnets[0].VpcId;i+=`<optgroup label="${window.subnets[0].VpcId}">`;for(let e=0;e<window.subnets.length;e++){var m,p;allowedVpcs[window.subnets[e].VpcId]&&(window.subnets[e].VpcId!==t&&(i+=`</optgroup><optgroup label="${window.subnets[e].VpcId}">`,t=window.subnets[e].VpcId),m=findNameFromTags(window.subnets[e].Tags)||window.subnets[e].SubnetId,p=findSubnetTypeFromTags(window.subnets[e].Tags)||guessSubnetType(m),i+=`<option az="${window.subnets[e].AvailabilityZone}" type="${p}" vpc="${window.subnets[e].VpcId}" value="${window.subnets[e].SubnetId}">${m} - ${window.subnets[e].CidrBlock} - ${window.subnets[e].AvailabilityZone}</option>`)}i+="</optgroup></select>"}else if("CSK::VpcEndpoint"===a.Type)i+=`<input id="${l}" name="${s}" class="vpc-endpoints">`;else if("CSK::EicEndpoint"===a.Type)i+=`<input id="${l}" name="${s}" class="eic-endpoint">`;else if("AWS::EC2::KeyPair::KeyName"===a.Type){i=`<select id="${l}" name="${s}" style="background-color: white">`;for(let e=0;e<window.keyPairs.length;e++)i+=`<option value="${window.keyPairs[e].KeyName}">${window.keyPairs[e].KeyName}</option>`;i+="</select>",0===window.keyPairs.length&&(i+=' <button id="create-key-pair-button">Create Key Pair</button>')}else if("CSK::DbEngineVersion"===a.Type){if(i=`<select id="${l}" name="${s}" class="dbengine-selector" onchange="filterDbInstanceClasses()">`,n){for(var g in window.dbEngines[n])i+=`<option engine="${n}" value="${g}">${window.dbEngines[n][g].DBEngineVersionDescription}</option>`;i+="</select>"}}else if("CSK::DbInstanceClass"===a.Type)i=`<select id="${l}" name="${s}" class="instance-class-selector" onchange="instanceClassSet(this)" onchange="storeInstanceClassState('${l}')"><option>Choose the DB engine first</option></select><br><p style="margin: -5px 2px; font-weight:bold" id="${l}-message"></p>`;else if("AWS::Route53::HostedZone::Id"===a.Type){for(var E in i=`<select id="${l}" name="${s}">`,i+='<option value="" zonename=""></option>',hostedZones)i+=`<option value="${E}" zonename="${hostedZones[E]}">${hostedZones[E]} (${E})</option>`;i+="</select>"}else if("AWS::EC2::Image::Id"===a.Type){if(i=`<select id="${l}" name="${s}" class="ami-selector" onchange="storeAmiState('${l}')">`,!t||"Windows"===t){i+='<optgroup label="Windows">';for(let e=0;e<window.amis.windows.length;e++)i+=`<option os="Windows" arch="${window.amis.windows[e].Architecture}" value="${window.amis.windows[e].ImageId}">${window.amis.windows[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}if(!t||"AmazonLinux"===t){i+='<optgroup label="Amazon Linux 2023">';for(let e=0;e<window.amis.linux2023.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2023[e].Architecture}" value="${window.amis.linux2023[e].ImageId}">${window.amis.linux2023[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2023 (Arm)">';for(let e=0;e<window.amis.linux2023Arm.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2023Arm[e].Architecture}" value="${window.amis.linux2023Arm[e].ImageId}">${window.amis.linux2023Arm[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2">';for(let e=0;e<window.amis.linux2.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2[e].Architecture}" value="${window.amis.linux2[e].ImageId}">${window.amis.linux2[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2 (Arm)">';for(let e=0;e<window.amis.linuxArm.length;e++)i+=`<option os="Linux" arch="${window.amis.linuxArm[e].Architecture}" value="${window.amis.linuxArm[e].ImageId}">${window.amis.linuxArm[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}if(!t||"Ubuntu"===t){i+='<optgroup label="Ubuntu">';for(let e=0;e<window.amis.ubuntu.length;e++)i+=`<option os="Linux" arch="${window.amis.ubuntu[e].Architecture}" value="${window.amis.ubuntu[e].ImageId}">${window.amis.ubuntu[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Ubuntu (Arm)">';for(let e=0;e<window.amis.ubuntuArm.length;e++)i+=`<option os="Linux" arch="${window.amis.ubuntuArm[e].Architecture}" value="${window.amis.ubuntuArm[e].ImageId}">${window.amis.ubuntuArm[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="RHEL">';for(let e=0;e<window.amis.rhel.length;e++)i+=`<option os="Linux" arch="${window.amis.rhel[e].Architecture}" value="${window.amis.rhel[e].ImageId}">${window.amis.rhel[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="RHEL (Arm)">';for(let e=0;e<window.amis.rhelArm.length;e++)i+=`<option os="Linux" arch="${window.amis.rhelArm[e].Architecture}" value="${window.amis.rhelArm[e].ImageId}">${window.amis.rhelArm[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}i+=`</select><p style="margin: -5px 2px; font-weight:bold" id="${l}-message"></p>`}else if("CSK::Userdata"===a.Type){inputElement=document.createElement("textarea");let e=getValueInNamespace(account,l);""===e&&(e=a.hasOwnProperty("Default")?a.Default:""),inputElement.setAttribute("id",l),inputElement.setAttribute("name",s),inputElement.setAttribute("class","userdata-textarea"),inputElement.defaultValue=e,inputElement.required=!0,i=inputElement.outerHTML,setTimeout(()=>{document.getElementById(l).onchange=userdataEdited},2e3)}else if("CSK::ValidAmi"===a.Type){o=document.createElement("input");o.setAttribute("id",l),o.setAttribute("name",s),o.setAttribute("pattern","ami-[a-f0-9]{17}"),setTimeout(()=>{document.getElementById(l).onkeyup=checkAmi},2e3),i=o.outerHTML}else{let e=null,t=(a.hasOwnProperty("AllowedPattern")&&(e=(e=a.AllowedPattern.replace(String.fromCharCode(92,92),String.fromCharCode(92))).replace(String.fromCharCode(47),String.fromCharCode(92,47))),document.createElement("input")),n=(e&&(t.pattern=e),50<=Number(a.MaxLength)?t=document.createElement("textarea"):"String"===a.Type?(t.setAttribute("type","text"),a.hasOwnProperty("MaxLength")&&(t.maxLength=a.MaxLength),a.hasOwnProperty("MinLength")&&(t.minLength=a.MinLength)):"Number"===a.Type&&(t.setAttribute("type","number"),a.hasOwnProperty("MinValue")&&(t.min=a.MinValue),a.hasOwnProperty("MaxValue")&&(t.max=a.MaxValue),t.setAttribute("style","width: 150px")),getValueInNamespace(account,l));"0.0.0.0/0"!==(n=""===n?a.hasOwnProperty("Default")?a.Default:"":n)&&"CSK::UserIp"!==a.Type||getMyIp().then(e=>{document.getElementById(l).value=e+"/32"}),t.setAttribute("id",l),t.setAttribute("name",s),t.defaultValue=n,t.required=!0,setTimeout(()=>{document.getElementById(l).onfocus=focusOff,document.getElementById(l).onblur=focusOff,document.getElementById(l).onkeyup=focusOff},2e3),i=t.outerHTML}return i}function focusOff(e){e.target.value?e.target.checkValidity()?(e.target.className="valid",setValueInNamespace(account,e.target.id,e.target.value)):e.target.className="invalid":e.target.className="empty"}function checkAmi(n){let a=n.target.id.split("|")[0];var e=n.target.id.split("|")[1].replace(/custom/,""),e=e.charAt(0).toLowerCase()+e.slice(1);let s=document.getElementById(a+"|"+e);s&&(s.disabled=!1),n.target.value?n.target.checkValidity()?window.describeAmis({ImageIds:[n.target.value]},(e,t)=>{e?n.target.className="invalid":(t=(e=t.Images[0]).PlatformDetails.match(/Linux/i)?"Linux":"Windows",filterInstanceTypes(a,e.Architecture),setUserDataDefault(a,t,e.Architecture),n.target.className="valid",setValueInNamespace(account,n.target.id,n.target.value),s&&(s.disabled=!0))}):n.target.className="invalid":n.target.className="empty"}function filterInstanceTypes(e,n){var a=document.getElementsByClassName("instance-type-selector");for(let t=0;t<a.length;t++){var s=a[t].id,o=s.split("|")[0];if(o===e){o=a[t].options[a[t].selectedIndex].getAttribute("arch");"x86_64"===n?(document.getElementById(s+"|suggestArm").hidden=!0,document.getElementById(s+"|suggestX86").hidden=!1):(document.getElementById(s+"|suggestArm").hidden=!1,document.getElementById(s+"|suggestX86").hidden=!0);for(let e=0;e<a[t].options.length;e++)a[t].options[e].hidden=!1;for(let e=0;e<a[t].options.length;e++)a[t].options[e].hidden=a[t].options[e].getAttribute("arch")!==n;n!==o&&suggestInstance(s,"x86_64"===n?"M":"Mg")}}}function filterByVpc(){var s=document.getElementsByClassName("vpc-selector");for(let a=0;a<s.length;a++){var o=s[a].id.split("|")[0],i=document.getElementsByClassName("subnet-selector");let n=null;for(let t=0;t<i.length;t++){var e=i[t].id.split("|")[0];if(e===o){for(let e=0;e<i[t].options.length;e++)i[t].options[e].hidden=!1;for(let e=0;e<i[t].options.length;e++)i[t].options[e].getAttribute("vpc")!==s[a].value?i[t].options[e].hidden=!0:(null===n&&(n=e),i[t].options[e].hidden=!1);i[t].selectedIndex=n}}var t=document.getElementsByClassName("eic-endpoint");for(let e=0;e<t.length;e++)t[e].id.split("|")[0]===o&&instanceConnectEndpoints.hasOwnProperty(s[a].value)&&(t[e].value=instanceConnectEndpoints[s[a].value].InstanceConnectEndpointId);var l=document.getElementsByClassName("vpc-endpoints");for(let e=0;e<l.length;e++)l[e].id.split("|")[0]===o&&vpcEndpoints.hasOwnProperty(s[a].value)&&(l[e].value=JSON.stringify(vpcEndpoints[s[a].value]))}}RegExp.quote=function(e){return e=(e=e.replaceAll(/([<>])/g,"\\$1")).replaceAll(/-]/g,"\\-]")};let sizeTypes={XS:["t3.nano","t2.nano"],S:["t3.small","t2.small"],M:["t3.medium","t2.medium"],L:["m7i.large","m6i.large","m5.large"],XL:["m7i.xlarge","m6i.xlarge","m5.xlarge"],XSg:["t4g.nano"],Sg:["t4g.small"],Mg:["m8g.medium","m7g.medium","m6g.medium","t4g.medium"],Lg:["m8g.large","m7g.large","m6g.large","t4g.large"],XLg:["m8g.xlarge","m7g.xlarge","m6g.xlarge","t4g.xlarge"]};function suggestInstance(t,n){for(let e=0;e<sizeTypes[n].length;e++)for(var a in window.instanceTypes)if(sizeTypes[n][e]===a)return document.getElementById(t).value=a,void filterAmis();document.getElementById(t+"-message").innerText="Unable to suggest an instance type"}let lastDbInstanceClassSelected=null;function storeInstanceClassState(){var t=document.getElementsByClassName("instance-class-selector");for(let e=0;e<t.length;e++)-1<t[e].selectedIndex&&(lastDbInstanceClassSelected=t[e].value)}function filterDbInstanceClasses(){var n=document.getElementsByClassName("dbengine-selector");for(let t=0;t<n.length;t++){var a=n[t].id.split("|")[0],s=document.getElementsByClassName("instance-class-selector");for(let e=0;e<s.length;e++){var o=s[e].id.split("|")[0];if(o===a){var i,l,o=s[e].value,r=(s[e].innerHTML="",window.dbInstances[n[t].options[n[t].selectedIndex].getAttribute("engine")][n[t].value]),d={},c={};for(i in r){var u=i.split(".")[1];d.hasOwnProperty(u)||(c[u]=document.createElement("optgroup"),d[c[u].label=u]=firstInstanceFamilySeen=!0),c[u].appendChild(new Option(i,i))}for(l in c)s[e].appendChild(c[l]);s[e].value=o,instanceClassSet(s[e])}}}}function instanceClassSet(e){-1===e.selectedIndex?document.getElementById(e.id+"-message").innerText="Please select an instance class":document.getElementById(e.id+"-message").innerText=""}let osType=null,currentArch={},lastArmAmi={},lastX86Ami={};function storeAmiState(t){var n=document.getElementsByClassName("ami-selector");for(let e=0;e<n.length;e++){var a,s,o=n[e].id.split("|")[0];-1<n[e].selectedIndex&&(a=n[e].options[n[e].selectedIndex].getAttribute("os"),"arm64"===(s=n[e].options[n[e].selectedIndex].getAttribute("arch"))?lastArmAmi[t]=n[e].value:lastX86Ami[t]=n[e].value,setUserDataDefault(o,a,s))}}let lastUserdata=null,userdataChanged={};function userdataEdited(e){""!==document.getElementById(e.target.id).value?userdataChanged[e.target.id]=!0:userdataChanged.hasOwnProperty(e.target.id)&&delete userdataChanged[e.target.id]}function setUserDataDefault(t,e,n){var a=window.getUserdataTemplate(e,n),s=e+"-"+n,o=document.getElementsByClassName("userdata-textarea");for(let e=0;e<o.length;e++){var i=o[e].id;null!==lastUserdata&&lastUserdata===s||i.split("|")[0]===t&&(o[e].value=a)}lastUserdata=s}function filterAmis(){var n=document.getElementsByClassName("instance-type-selector");for(let e=0;e<n.length;e++){var a=-1<n[e].selectedIndex?n[e].options[n[e].selectedIndex].getAttribute("arch"):null,s=n[e].id.split("|")[0],o=document.getElementsByClassName("ami-selector"),i=a||"x86_64";let t=null;for(let e=0;e<o.length;e++){var l=o[e],r=l.id,d=r.split("|")[0];if(d===s&&(lastArmAmi.hasOwnProperty(r)||(lastArmAmi[r]=null),lastX86Ami.hasOwnProperty(r)||(lastX86Ami[r]=null),currentArch.hasOwnProperty(r)||(currentArch[r]=null),!currentArch[r]||i!==currentArch[r])){for(let e=0;e<l.options.length;e++)l.options[e].hidden=!1;if("arm64"===i&&lastArmAmi[r]){l.value=lastArmAmi[r];for(let e=0;e<l.options.length;e++)if(l.options[e].value===lastArmAmi[r]){t=e;break}l.selectedIndex=t}else if("x86_64"===i&&lastX86Ami[r]){l.value=lastX86Ami[r];for(let e=0;e<l.options.length;e++)if(l.options[e].value===lastX86Ami[r]){t=e;break}l.selectedIndex=t}else if(-1<l.selectedIndex){if(l.options[l.selectedIndex].getAttribute("arch")!==i){for(let e=0;e<l.options.length;e++)if(l.options[e].getAttribute("arch")===i){t=e;break}l.selectedIndex=t}}else{for(let e=0;e<l.options.length;e++)if(l.options[e].getAttribute("arch")===i){t=e;break}l.selectedIndex=t}for(let e=0;e<l.options.length;e++)l.options[e].getAttribute("arch")!==i?(l.options[e].selected=!1,l.options[e].hidden=!0):l.options[e].hidden=!1;currentArch[r]=i,storeAmiState(r)}}}}let debounceWaiter=null;function debounceDisplayTemplateConfig(){debounceWaiter&&clearTimeout(debounceWaiter),debounceWaiter=setTimeout(refreshFormElements,300)}function refreshFormElements(){for(var e in kitConfigsShowing)configureKit(e)}function displayCredentialErrors(e,t){e?(document.getElementById("credential-errors").innerText=t,document.getElementById("credential-error-block").hidden=!1):(document.getElementById("credential-errors").innerText="",document.getElementById("credential-error-block").hidden=!0)}function displayErrors(e,t=null){"object"==typeof e&&(e=e.toString()),document.getElementById("general-errors").innerText=e,t&&((e=document.createElement("a")).href=t,e.target="_blank",e.innerText="Click here to open console",e.style.cursor="pointer",e.style.marginLeft="6px",e.style.display="inline-block",e.addEventListener("click",e=>{window.openInBrowser(t),e.stopPropagation()}),document.getElementById("general-errors").appendChild(e)),document.getElementById("general-error-block").hidden=!1}function hideErrors(){document.getElementById("general-error-block").hidden=!0,document.getElementById("general-errors").innerText=""}function displaySessionErrors(e,t){let n="";e&&e.toString().match(/Missing credentials in config, if using AWS_CONFIG_FILE, set AWS_SDK_LOAD_CONFIG=1/)?n="Waiting for credentials...":e&&(n=e.toString()),n?(window.loggedIn=!1,document.getElementById("session-errors").innerText=n,document.getElementById("session-error-block").style.display="block",document.getElementById("pasted-credentials").innerText="",switchLeftMenuItem({target:{id:"switch-accounts-button",content:"credentials-block"}})):(window.loggedIn=!0,document.getElementById("session-error-block").style.display="none",document.getElementById("session-errors").innerText="")}let previousLanguage=null;function setLanguage(){var e=document.getElementById("lang-select").value;null!==previousLanguage&&phoneHome({action:"switched language to "+e}),previousLanguage=e,window.dispatchEvent(new Event("LanguageChange"))}function checkSessionWrapper(){window.checkSession(displaySessionErrors)}function resetUi(){document.getElementById("no-vpc-warning").hidden=!0,document.getElementById("session-error-block").style.display="none",document.getElementById("general-error-block").hidden=!0,document.getElementById("sdk-output").hidden=!1,document.getElementById("loading-block").style.display="block",document.getElementById("credentials-block").hidden=!1,document.getElementById("credential-error-block").hidden=!0,document.getElementById("pasted-credentials").innerText=""}function openRightMenu(){document.getElementById("right-hand-menu").style.display="block",document.getElementById("right-hand-menu-closed").style.display="none",document.getElementById("main-content-area").addEventListener("click",closeRightMenu),document.getElementById("main-content-area").classList.add("scrunched")}function closeRightMenu(){document.getElementById("right-hand-menu").style.display="none",document.getElementById("right-hand-menu-closed").style.display="block",document.getElementById("main-content-area").removeEventListener("click",closeRightMenu),document.getElementById("main-content-area").classList.remove("scrunched")}setInterval(checkSessionWrapper,6e4);let lastContentRequested=null;function switchLeftMenuItem(e){var t=e.target.hasOwnProperty("content")?e.target.content:e.target.getAttribute("content");if(t!==lastContentRequested){var n=document.getElementsByClassName("left-hand-menu-item");for(let e=0;e<n.length;e++){n[e].classList.remove("left-hand-menu-item-selected");var a=n[e].getAttribute("content");a&&(document.getElementById(a).hidden=!0)}document.getElementById(t).hidden=!1,phoneHome({action:"switched to "+t}),document.getElementById(e.target.id).classList.add("left-hand-menu-item-selected"),lastContentRequested=t}"deployed-stacks"===t&&listAllStacks()}function toggleCredentialTypes(e=null){null===e||"strings-credentials-h3"===e.target.id?(document.getElementById("strings-credentials-h3").classList.add("fake-focus"),document.getElementById("strings-credentials-h4").classList.remove("fake-focus"),document.getElementById("temporary-credentials-div").hidden=!1,document.getElementById("long-lived-credentials-div").hidden=!0):(document.getElementById("strings-credentials-h3").classList.remove("fake-focus"),document.getElementById("strings-credentials-h4").classList.add("fake-focus"),document.getElementById("temporary-credentials-div").hidden=!0,document.getElementById("long-lived-credentials-div").hidden=!1)}checkForKey(),addEventListener("UI_DATA_UPDATE",debounceDisplayTemplateConfig),document.getElementById("region-select").addEventListener("change",updateRegion),document.getElementById("lang-select").addEventListener("change",setLanguage),document.getElementById("submit-credentials-button").addEventListener("click",addCredentials),document.getElementById("hide-errors").addEventListener("click",hideErrors),document.getElementById("hide-errors-button").addEventListener("click",hideErrors),document.getElementById("unlock-button").addEventListener("click",fetchConfigForKey),document.getElementById("enter-different-key").addEventListener("click",purgeConfig),document.getElementById("right-hand-menu-closed").addEventListener("click",openRightMenu),document.getElementById("install-a-kit-button").addEventListener("click",switchLeftMenuItem),document.getElementById("review-installed-button").addEventListener("click",switchLeftMenuItem),document.getElementById("switch-accounts-button").addEventListener("click",switchLeftMenuItem),document.getElementById("strings-credentials-h3").addEventListener("click",toggleCredentialTypes),document.getElementById("strings-credentials-h4").addEventListener("click",toggleCredentialTypes);